$(document).ready(function(){
    

    const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value;
    var new_tab ;

    // Attacker Machine 
    // click on start instance
    $("#startInstanceBtn").click(function(){
        const data = {
            action : 'startInstance',
            }
    
        axios.post('terminal/',data,{headers: {'X-CSRFToken': csrftoken}})
        .then(res => {
            console.log(res.data)
            document.getElementById("fullScreenBtn").onclick = function(){
                new_tab = window.open() ;
                new_tab.opener = null ;
                new_tab.location = res.data.link ;
            }
        })
        .then(err => console.error(err));

        var btn = $(this)
        setTimeout(function(){
            $(btn).hide();
            document.getElementById("instanceOffline").style.display = "none";
            document.getElementById("startLoading").style.display = "block";
            setTimeout(function(){
                document.getElementById("startLoading").style.display = "none";
                document.getElementById("instanceOnline").style.display = "block";
                $("#fullScreenBtn").toggle(1000);
                $("#terminateInstanceBtn").toggle(1000);
            },5000);
        }, 500);

    });
    // click on the interact button :
    $("#fullScreenBtn").click(function(){
        const data = {
            action : 'interract',
            }
    
        axios.post('terminal/',data,{headers: {'X-CSRFToken': csrftoken}})
        .then(res => {
            console.log(res.data)
            new_tab = window.open() ;
            new_tab.opener = null ;
            new_tab.location = res.data.link ;
            
        })
        .then(err => console.error(err));
    })

    // click on terminate instance button
    $("#terminateInstanceBtn").click(function(){
        const data = {
            action : 'terminateInstance',
            }

        axios.post('terminal/',data,{headers: {'X-CSRFToken': csrftoken}})
        .then(res => console.log(res.data))
        .then(err => console.error(err));
        

        setTimeout(function(){
            var btn = $(this)
            document.getElementById("instanceOnline").style.display = "none";
            document.getElementById("terminateLoading").style.display = "block";
            setTimeout(function(){
                $(btn).hide();
                document.getElementById("terminateLoading").style.display = "none";
                document.getElementById("instanceOffline").style.display = "block";
                $("#startInstanceBtn").toggle(1000);
                $("#terminateInstanceBtn").hide();
                $("#fullScreenBtn").hide();
            }, 5000);
        },500);


    });
/************************************************************************************************/
    
    // Victime Machines


    //click on start button
    $("#btn-start").click(function(){
    
    // My Code :   ************************************************************
    // Sending Start request to the backend
    const data = {
        action : 'start',
        }

    axios.post('terminal/',data,{headers: {'X-CSRFToken': csrftoken}})
    .then(res => {
        console.log(res)
        // document.getElementById("btn-lab-link").onclick = function(){
        //     var new_tab  = window.open() ;
        //     new_tab.opener = null ;
        //     new_tab.location = res.data.link ;
        // }
        if (res.data.link) {
            var btn = $(this);
            $(btn).buttonLoader('start');
                setTimeout(function(){
                $("#btn-quit").toggle(1000);
                // $("#btn-stop").toggle(1000);
                $(btn).hide(1000);
                // $("#btn-lab-link").toggle(1000);
                $("#level-inProgress").toggle(1000);
                $("#level-stopped").hide();
                
                $(btn).buttonLoader('stop');
                document.getElementById("ip").style.display = "block" ;
                                 }, 3000);
        }
        else {
            //document.getElementById("warning").style.display = "block" ;
            alert("Please Power On the Attack Machine !");
        }

    })
    .then(err => console.error(err));
    // End of the sending request
    // End of Code  *******************************************************

    });
    
    //click on Quit button
    $("#btn-quit").click(function(){

    // Sending a quit request to the Backend **************************************
    const data = {
        action :'quit'
    }
    axios.post('terminal/',data,{headers: {'X-CSRFToken': csrftoken}})
    .then(res => console.log(res.data))
    .then(err => console.error(err));
    // End of the sending request           ***************************************

    var btn = $(this);
    $(btn).buttonLoader('start-q');
        setTimeout(function(){
        
        $("#btn-stop").fadeOut(1000);
        $(btn).hide(1000);
        $("#btn-start").show();
        // $("#btn-lab-link").fadeOut(1000);
        $("#level-inProgress").fadeOut(1000);
        $("#level-stopped").hide();
        $("#btn-continue").hide();
        $(btn).buttonLoader('stop-q');
        document.getElementById("ip").style.display = "none" ;
                         }, 3000);
    });
    //click on stop button
     $("#btn-stop").click(function(){

    // Sending Start request to the backend  ****************************************
    const data = {
        action : 'stop',
        }

    axios.post('terminal/',data,{headers: {'X-CSRFToken': csrftoken}})
    .then(res => console.log(res.data))
    .then(err => console.error(err));
    // End of the sending request           ******************************************

    var btn = $(this);
    $(btn).buttonLoader('start-s');
        setTimeout(function(){
        
        $("#btn-quit").show();
        $("#btn-continue").show();
        $(btn).hide(1000);
        $("#btn-start").fadeOut(1000);
        // $("#btn-lab-link").fadeOut(1000);
        $("#level-inProgress").fadeOut(1000);
        $("#level-stopped").show();
        
        $(btn).buttonLoader('stop-s');
                         }, 3000);
    });
    //click on continue button
     $("#btn-continue").click(function(){
    // Sending Start request to the backend
    const data = {
        action : 'continue',
        }

    axios.post('terminal/',data,{headers: {'X-CSRFToken': csrftoken}})
    .then(res => console.log(res.data))
    .then(err => console.error(err));
    // End of the sending request
    var btn = $(this);
    $(btn).buttonLoader('start-c');
        setTimeout(function(){
        $("#btn-quit").show();
        $("#btn-stop").show();
        // $("#btn-lab-link").show(1000);
        $(btn).hide(1000);
        $("#btn-start").fadeOut(1000);
        
        $("#level-inProgress").show(1000);
        $("#level-stopped").fadeOut(1000);
        
        $(btn).buttonLoader('stop-c');
                         }, 3000);
    });
}
);
